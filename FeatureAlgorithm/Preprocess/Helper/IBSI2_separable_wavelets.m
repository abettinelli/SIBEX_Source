function ROIImageInfo = IBSI2_separable_wavelets(ROIImageInfo, Param, wavelet_type)

for l=1:Param.level
    
    [MonoFilterBank, FilterKernel]=get_separable_filter(Param, l, wavelet_type);
    
    % Filtering
    switch Param.type
        case '2D' % Slice by slice
            par_Image = ROIImageInfo.MaskData;
            parfor i=1:ROIImageInfo.ZDim
                if ~Param.rotation_invariance
                    par_FilteredData(:, :, i)=imfilter(par_Image(:, :, i), FilterKernel, Param.padding, 'same', 'conv');
                else
                    par_FilteredData(:, :, i)=IBSI2_imfilter_ri(par_Image(:, :, i), MonoFilterBank, Param.padding, Param.pooling);
                end
            end
            ROIImageInfo.MaskData = par_FilteredData;
        case '3D' % All volume at once
            if ~Param.rotation_invariance
                FilteredData=imfilter(ROIImageInfo.MaskData, FilterKernel, Param.padding, 'same', 'conv');
            else
                FilteredData=IBSI2_imfilter_ri(ROIImageInfo.MaskData, MonoFilterBank, Param.padding, Param.pooling);
            end
    end
    ROIImageInfo.MaskData=FilteredData;
end

function [monoFilterBank, FilterKernel] = get_separable_filter(Param, curr_l, wavelet_type)

desired_level = Param.level;

if isequal(wavelet_type, 'daub')
    if Param.number == 1
        L = [0.7071067811865476 0.7071067811865476];
        H = [-0.7071067811865476 0.7071067811865476];
    elseif Param.number == 2
        L = [-0.12940952255092145 0.22414386804185735 0.836516303737469 0.48296291314469025];
        H = [-0.48296291314469025 0.836516303737469 -0.22414386804185735 -0.12940952255092145];
    elseif Param.number == 3
        L = [0.035226291882100656 -0.08544127388224149 -0.13501102001039084 0.4598775021193313 0.8068915093133388 0.3326705529509569];
        H = [-0.3326705529509569 0.8068915093133388 -0.4598775021193313 -0.13501102001039084 0.08544127388224149 0.035226291882100656];
    elseif Param.number == 4
        L = [-0.010597401784997278 0.032883011666982945 0.030841381835986965 -0.18703481171888114 -0.02798376941698385 0.6308807679295904 0.7148465705525415 0.23037781330885523];
        H = [-0.23037781330885523 0.7148465705525415 -0.6308807679295904 -0.02798376941698385 0.18703481171888114 0.030841381835986965 -0.032883011666982945 -0.010597401784997278];
    elseif Param.number == 5
        L = [0.003335725285001549 -0.012580751999015526 -0.006241490213011705 0.07757149384006515 -0.03224486958502952 -0.24229488706619015 0.13842814590110342 0.7243085284385744 0.6038292697974729 0.160102397974125];
        H = [-0.160102397974125 0.6038292697974729 -0.7243085284385744 0.13842814590110342 0.24229488706619015 -0.03224486958502952 -0.07757149384006515 -0.006241490213011705 0.012580751999015526 0.003335725285001549];
    elseif Param.number == 6
        L = [-0.00107730108499558 0.004777257511010651 0.0005538422009938016 -0.031582039318031156 0.02752286553001629 0.09750160558707936 -0.12976686756709563 -0.22626469396516913 0.3152503517092432 0.7511339080215775 0.4946238903983854 0.11154074335008017];
        H = [-0.11154074335008017 0.4946238903983854 -0.7511339080215775 0.3152503517092432 0.22626469396516913 -0.12976686756709563 -0.09750160558707936 0.02752286553001629 0.031582039318031156 0.0005538422009938016 -0.004777257511010651 -0.00107730108499558];
    elseif Param.number == 7
        L = [0.0003537138000010399 -0.0018016407039998328 0.00042957797300470274 0.012550998556013784 -0.01657454163101562 -0.03802993693503463 0.0806126091510659 0.07130921926705004 -0.22403618499416572 -0.14390600392910627 0.4697822874053586 0.7291320908465551 0.39653931948230575 0.07785205408506236];
        H = [-0.07785205408506236 0.39653931948230575 -0.7291320908465551 0.4697822874053586 0.14390600392910627 -0.22403618499416572 -0.07130921926705004 0.0806126091510659 0.03802993693503463 -0.01657454163101562 -0.012550998556013784 0.00042957797300470274 0.0018016407039998328 0.0003537138000010399];
    elseif Param.number == 8
        L = [-0.00011747678400228192 0.0006754494059985568 -0.0003917403729959771 -0.00487035299301066 0.008746094047015655 0.013981027917015516 -0.04408825393106472 -0.01736930100202211 0.128747426620186 0.00047248457399797254 -0.2840155429624281 -0.015829105256023893 0.5853546836548691 0.6756307362980128 0.3128715909144659 0.05441584224308161];
        H = [-0.05441584224308161 0.3128715909144659 -0.6756307362980128 0.5853546836548691 0.015829105256023893 -0.2840155429624281 -0.00047248457399797254 0.128747426620186 0.01736930100202211 -0.04408825393106472 -0.013981027917015516 0.008746094047015655 0.00487035299301066 -0.0003917403729959771 -0.0006754494059985568 -0.00011747678400228192];
    elseif Param.number == 9
        L = [3.9347319995026124e-05 -0.0002519631889981789 0.00023038576399541288 0.0018476468829611268 -0.004281503681904723 -0.004723204757894831 0.022361662123515244 0.00025094711499193845 -0.06763282905952399 0.030725681478322865 0.14854074933476008 -0.09684078322087904 -0.29327378327258685 0.13319738582208895 0.6572880780366389 0.6048231236767786 0.24383467463766728 0.03807794736316728];
        H = [-0.03807794736316728 0.24383467463766728 -0.6048231236767786 0.6572880780366389 -0.13319738582208895 -0.29327378327258685 0.09684078322087904 0.14854074933476008 -0.030725681478322865 -0.06763282905952399 -0.00025094711499193845 0.022361662123515244 0.004723204757894831 -0.004281503681904723 -0.0018476468829611268 0.00023038576399541288 0.0002519631889981789 3.9347319995026124e-05];
    elseif Param.number == 10
        L = [-1.326420300235487e-05 9.358867000108985e-05 -0.0001164668549943862 -0.0006858566950046825 0.00199240529499085 0.0013953517469940798 -0.010733175482979604 0.0036065535669883944 0.03321267405893324 -0.02945753682194567 -0.07139414716586077 0.09305736460380659 0.12736934033574265 -0.19594627437659665 -0.24984642432648865 0.2811723436604265 0.6884590394525921 0.5272011889309198 0.18817680007762133 0.026670057900950818];
        H = [-0.026670057900950818 0.18817680007762133 -0.5272011889309198 0.6884590394525921 -0.2811723436604265 -0.24984642432648865 0.19594627437659665 0.12736934033574265 -0.09305736460380659 -0.07139414716586077 0.02945753682194567 0.03321267405893324 -0.0036065535669883944 -0.010733175482979604 -0.0013953517469940798 0.00199240529499085 0.0006858566950046825 -0.0001164668549943862 -9.358867000108985e-05 -1.326420300235487e-05];
    end
elseif isequal(wavelet_type, 'coif')
    if Param.number == 1
        L = [-0.01565572813546454 -0.0727326195128539 0.38486484686420286 0.8525720202122554 0.3378976624578092 -0.0727326195128539 0];
        H = [0.0727326195128539 0.3378976624578092 -0.8525720202122554 0.38486484686420286 0.0727326195128539 -0.01565572813546454 0];
    elseif Param.number == 2
        L = [-0.0007205494453645122 -0.0018232088707029932 0.0056114348193944995 0.023680171946334084 -0.0594344186464569 -0.0764885990783064 0.41700518442169254 0.8127236354455423 0.3861100668211622 -0.06737255472196302 -0.04146493678175915 0.016387336463522112];
        H = [-0.016387336463522112 -0.04146493678175915 0.06737255472196302 0.3861100668211622 -0.8127236354455423 0.41700518442169254 0.0764885990783064 -0.0594344186464569 -0.023680171946334084 0.0056114348193944995 0.0018232088707029932 -0.0007205494453645122];
    elseif Param.number == 3
        L = [-3.45997728362126e-05,-7.09833031381413e-05,0.000466216960112886,0.00111751877089060,-0.00257451768875022,-0.00900797613666158,0.0158805448636159,0.0345550275730616,-0.0823019271068860,-0.0717998216193120,0.428483476377619,0.793777222625621,0.405176902409617,-0.0611233900026729,-0.0657719112818555,0.0234526961418363,0.00778259642732542,-0.00379351286449101];
        H = [0.00379351286449101,0.00778259642732542,-0.0234526961418363,-0.0657719112818555,0.0611233900026729,0.405176902409617,-0.793777222625621,0.428483476377619,0.0717998216193120,-0.0823019271068860,-0.0345550275730616,0.0158805448636159,0.00900797613666158,-0.00257451768875022,-0.00111751877089060,0.000466216960112886,7.09833031381413e-05,-3.45997728362126e-05];
    elseif Param.number == 4
        L = [-1.78498500308826e-06,-3.25968023688337e-06,3.12298758653456e-05,6.23390344610071e-05,-0.000259974552487713,-0.000589020756244338,0.00126656192929894,0.00375143615727846,-0.00565828668661072,-0.0152117315279463,0.0250822618448641,0.0393344271233375,-0.0962204420339880,-0.0666274742634250,0.434386056491469,0.782238930920499,0.415308407030430,-0.0560773133167548,-0.0812666996808788,0.0266823001560531,0.0160689439647763,-0.00734616632764209,-0.00162949201260173,0.000892313668582315];
        H = [-0.000892313668582315,-0.00162949201260173,0.00734616632764209,0.0160689439647763,-0.0266823001560531,-0.0812666996808788,0.0560773133167548,0.415308407030430,-0.782238930920499,0.434386056491469,0.0666274742634250,-0.0962204420339880,-0.0393344271233375,0.0250822618448641,0.0152117315279463,-0.00565828668661072,-0.00375143615727846,0.00126656192929894,0.000589020756244338,-0.000259974552487713,-6.23390344610071e-05,3.12298758653456e-05,3.25968023688337e-06,-1.78498500308826e-06];
    elseif Param.number == 5
        L = [-9.51765727381917e-08,-1.67442885768230e-07,2.06376185136468e-06,3.73465517514140e-06,-2.13150268099558e-05,-4.13404322725125e-05,0.000140541149702034,0.000302259581813063,-0.000638131343045111,-0.00166286370201308,0.00243337321265767,0.00676418544805308,-0.00916423116248185,-0.0197617789425726,0.0326835742671118,0.0412892087501817,-0.105574208703339,-0.0620359639629036,0.437991626171837,0.774289603652956,0.421566206690852,-0.0520431631762438,-0.0919200105596962,0.0281680289709364,0.0234081567858392,-0.0101311175198498,-0.00415935878138605,0.00217823635810902,0.000358589687895738,-0.000212080839803798];
        H = [0.000212080839803798,0.000358589687895738,-0.00217823635810902,-0.00415935878138605,0.0101311175198498,0.0234081567858392,-0.0281680289709364,-0.0919200105596962,0.0520431631762438,0.421566206690852,-0.774289603652956,0.437991626171837,0.0620359639629036,-0.105574208703339,-0.0412892087501817,0.0326835742671118,0.0197617789425726,-0.00916423116248185,-0.00676418544805308,0.00243337321265767,0.00166286370201308,-0.000638131343045111,-0.000302259581813063,0.000140541149702034,4.13404322725125e-05,-2.13150268099558e-05,-3.73465517514140e-06,2.06376185136468e-06,1.67442885768230e-07,-9.51765727381917e-08];
    end
elseif isequal(wavelet_type, 'haar')
    L = [1 1]./sqrt(2);
    H = [-1 1]./sqrt(2);
    
end

if curr_l < desired_level
    % Return LLL
    for i =1:length(Param.sequence)
        monoFilterBank{i,1} = L;
    end
else
    % Return the desired combination of High and Low filters
    for i =1:length(Param.sequence)
        f_type=Param.sequence(i);
        switch f_type
            case 'H'
                monoFilterBank{i,1} = H;
                
            case 'L'
                monoFilterBank{i,1} = L;
        end
    end
end

% A trous
monoFilterBank = IBSI2_a_trous(monoFilterBank, curr_l);

% Eventually add zeros to even kernels
monoFilterBank = IBSI2_append_zero_on_even(monoFilterBank);

% Create Kernel
FilterKernel = IBSI2_create_filter_kernel(monoFilterBank);
